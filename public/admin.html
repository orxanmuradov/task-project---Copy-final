 <!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        body { padding: 20px; color: white; background: #121212; display: block; }
        .admin-container { max-width: 900px; margin: 0 auto; background: #1e1e1e; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        h1, h2 { color: #ffcc00; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #444; padding: 12px; text-align: left; }
        th { background: #333; color: #ffcc00; }
        
        /* DÃ¼ymÉ™lÉ™r */
        .btn-action { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-right: 5px; font-size: 0.85rem; }
        
        .btn-delete { background: #ff4d4d; color: white; } /* QÄ±rmÄ±zÄ± */
        .btn-delete:hover { background: #cc0000; }
        
        .btn-make-admin { background: #00e676; color: black; } /* YaÅŸÄ±l */
        .btn-make-user { background: orange; color: black; }    /* NarÄ±ncÄ± */

        .btn-reset { background: #ffcc00; color: black; } /* SarÄ± */
        .btn-reset:hover { background: #e6b800; }

        .header-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .back-btn { background: #333; color: white; padding: 10px 20px; border: 1px solid #555; border-radius: 5px; text-decoration: none; }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="header-actions">
            <h1>ğŸ›¡ï¸ Admin Ä°darÉ™etmÉ™</h1>
            <div>
                <a href="/" class="back-btn">Ana SÉ™hifÉ™</a>
                <button id="logout-btn" class="back-btn" style="border-color:red; color:red;">Ã‡Ä±xÄ±ÅŸ</button>
            </div>
        </div>

        <h2>ğŸ‘¥ Ä°stifadÉ™Ã§ilÉ™r</h2>
        <div style="overflow-x:auto;">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ad</th>
                        <th>Rol</th>
                        <th>ÆmÉ™liyyatlar</th>
                    </tr>
                </thead>
                <tbody id="users-table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const token = localStorage.getItem("token");
        const role = localStorage.getItem("role");

        if (!token || role !== "admin") {
            alert("Siz Admin deyilsiniz!");
            window.location.href = "/";
        }

        document.getElementById("logout-btn").addEventListener("click", () => {
            localStorage.clear();
            window.location.href = "/login";
        });

        async function loadUsers() {
            try {
                const res = await fetch("/api/admin/users", { headers: { "Authorization": `Bearer ${token}` } });
                if(!res.ok) throw new Error("Ä°cazÉ™ yoxdur");
                
                const data = await res.json();
                const tbody = document.getElementById("users-table-body");
                tbody.innerHTML = "";

                data.users.forEach(u => {
                    let roleBtn = "";
                    if (u.role === 'user') {
                        roleBtn = `<button onclick="changeRole(${u.id}, 'admin')" class="btn-action btn-make-admin" title="Admin et">â¬†ï¸ Admin</button>`;
                    } else {
                        roleBtn = `<button onclick="changeRole(${u.id}, 'user')" class="btn-action btn-make-user" title="User et">â¬‡ï¸ User</button>`;
                    }

                    tbody.innerHTML += `
                        <tr>
                            <td>${u.id}</td>
                            <td>${u.username}</td>
                            <td><span style="font-weight:bold; color:${u.role==='admin'?'#ffcc00':'#ccc'}">${u.role.toUpperCase()}</span></td>
                            <td>
                                ${roleBtn}
                                <button onclick="resetPassword(${u.id}, '${u.username}')" class="btn-action btn-reset" title="ÅifrÉ™ni 12345 et">ğŸ”‘ Reset</button>
                                <button onclick="deleteUser(${u.id})" class="btn-action btn-delete" title="Sil">ğŸ—‘ï¸</button>
                            </td>
                        </tr>
                    `;
                });

            } catch (error) {
                console.error(error);
                alert("MÉ™lumat yÃ¼klÉ™nmÉ™di.");
            }
        }

        // --- ROL DÆYÄ°ÅDÄ°RMÆK ---
        window.changeRole = async (id, newRole) => {
            if(!confirm(`Bu istifadÉ™Ã§ini '${newRole.toUpperCase()}' etmÉ™k istÉ™yirsÉ™n?`)) return;
            const res = await fetch(`/api/admin/users/${id}/role`, {
                method: "PUT",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
                body: JSON.stringify({ role: newRole })
            });
            if(res.ok) { alert("Rol dÉ™yiÅŸdirildi!"); loadUsers(); }
        };

        // --- ÅÄ°FRÆ SIFIRLAMAQ (RESET) ---
        window.resetPassword = async (id, name) => {
            if(!confirm(`"${name}" adlÄ± istifadÉ™Ã§inin ÅŸifrÉ™sini '12345' olaraq sÄ±fÄ±rlamaq istÉ™yirsÉ™n?`)) return;
            
            const res = await fetch(`/api/admin/users/${id}/reset-password`, {
                method: "PUT",
                headers: { "Authorization": `Bearer ${token}` }
            });

            if(res.ok) {
                alert(`UÄŸurlu! "${name}" istifadÉ™Ã§isinin yeni ÅŸifrÉ™si: 12345`);
            } else {
                alert("XÉ™ta baÅŸ verdi.");
            }
        };

        // --- SÄ°LMÆK ---
        window.deleteUser = async (id) => {
            if(!confirm("Ä°stifadÉ™Ã§ini hÉ™miÅŸÉ™lik silmÉ™k istÉ™yirsÉ™n?")) return;
            const res = await fetch(`/api/admin/users/${id}`, { method: "DELETE", headers: { "Authorization": `Bearer ${token}` } });
            if(res.ok) loadUsers();
        };

        loadUsers();
    </script>
</body>
</html>